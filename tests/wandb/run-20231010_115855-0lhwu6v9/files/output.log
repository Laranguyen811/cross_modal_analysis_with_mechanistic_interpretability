
Config is: GlobalConfig(image=ImageConfig(image_size=28, patch_size=7, n_channels=1), transformer=TransformerConfig(hidden_dim=128, num_heads=4, num_layers=4, mlp_dim=512, activation_name='GELU', attention_only=True, attn_hidden_layer=True), layernorm=LayerNormConfig(qknorm=False, layer_norm_eps=0.0), dropout=DropoutConfig(patch=0.0, position=0.0, attention=0.0, proj=0.0, mlp=0.0), init=InitializationConfig(weight_type='he', cls_std=1e-06, pos_std=0.02), training=TrainingConfig(loss_fn_name='CrossEntropy', lr=0.001, num_epochs=5, batch_size=64, warmup_steps=0, weight_decay=0.0, device='cuda', seed=0, optimizer_name='AdamW'), logging=LoggingConfig(log_dir='logs', log_frequency=10, print_every=0, use_wandb=True), saving=SavingConfig(parent_dir='/network/scratch/s/sonia.joseph/vit_planetarium', save_dir='checkpoints', save_checkpoints=True, save_cp_frequency=10), classification=<vit_planetarium.configs.MNISTConfig.ClassificationConfig object at 0x7fc6d2d952d0>)
  0%|                                                                                                                                                                                                                                                                           | 0/5 [00:00<?, ?it/s]
0it [00:00, ?it/s]

9it [00:06,  1.94it/s]

21it [00:09,  3.03it/s]

33it [00:11,  4.24it/s]
Steps30 | Train loss: 0.044 | Train acc: 0.341 | Test loss: 0.044 | Test acc: 0.334

49it [00:12,  6.96it/s]

53it [00:14,  5.22it/s]

73it [00:17,  5.58it/s]

89it [00:19,  7.86it/s]
Steps80 | Train loss: 0.023 | Train acc: 0.521 | Test loss: 0.025 | Test acc: 0.471

93it [00:20,  5.64it/s]

109it [00:22,  7.93it/s]

129it [00:25,  7.98it/s]

133it [00:27,  5.72it/s]
Steps130 | Train loss: 0.018 | Train acc: 0.639 | Test loss: 0.019 | Test acc: 0.589

149it [00:28,  8.02it/s]

153it [00:30,  5.72it/s]

173it [00:33,  5.77it/s]

189it [00:35,  7.99it/s]
Steps180 | Train loss: 0.015 | Train acc: 0.690 | Test loss: 0.017 | Test acc: 0.634

193it [00:36,  5.68it/s]

209it [00:38,  7.94it/s]

229it [00:41,  8.03it/s]

233it [00:43,  5.73it/s]
Steps230 | Train loss: 0.013 | Train acc: 0.738 | Test loss: 0.016 | Test acc: 0.676

249it [00:44,  8.02it/s]

253it [00:46,  5.77it/s]

273it [00:49,  5.79it/s]
Steps270 | Train loss: 0.012 | Train acc: 0.766 | Test loss: 0.014 | Test acc: 0.713

289it [00:50,  8.06it/s]

293it [00:52,  5.77it/s]

309it [00:54,  8.00it/s]

329it [00:57,  7.96it/s]
Steps320 | Train loss: 0.011 | Train acc: 0.795 | Test loss: 0.013 | Test acc: 0.744

333it [00:58,  5.69it/s]

349it [01:00,  8.03it/s]

361it [01:03,  5.54it/s]

373it [01:05,  5.80it/s]
Steps370 | Train loss: 0.009 | Train acc: 0.832 | Test loss: 0.011 | Test acc: 0.767

389it [01:06,  8.10it/s]

393it [01:08,  5.82it/s]

413it [01:11,  5.84it/s]

429it [01:13,  8.13it/s]
Steps420 | Train loss: 0.009 | Train acc: 0.832 | Test loss: 0.011 | Test acc: 0.795

433it [01:14,  5.81it/s]

449it [01:16,  8.09it/s]
Steps450 | Train loss: 0.008 | Train acc: 0.833 | Test loss: 0.011 | Test acc: 0.783

469it [01:19,  8.10it/s]

473it [01:20,  5.81it/s]

489it [01:22,  8.12it/s]

501it [01:25,  5.57it/s]
Steps500 | Train loss: 0.007 | Train acc: 0.840 | Test loss: 0.010 | Test acc: 0.809

513it [01:27,  5.82it/s]

529it [01:28,  8.06it/s]

533it [01:30,  5.75it/s]

553it [01:33,  5.74it/s]
Steps550 | Train loss: 0.007 | Train acc: 0.861 | Test loss: 0.008 | Test acc: 0.833

569it [01:35,  8.06it/s]

573it [01:36,  5.80it/s]

589it [01:38,  8.09it/s]
Steps590 | Train loss: 0.007 | Train acc: 0.866 | Test loss: 0.009 | Test acc: 0.817

609it [01:41,  8.08it/s]

613it [01:43,  5.75it/s]

629it [01:44,  8.03it/s]

633it [01:46,  5.77it/s]
Steps640 | Train loss: 0.009 | Train acc: 0.820 | Test loss: 0.012 | Test acc: 0.772

653it [01:49,  5.79it/s]

669it [01:51,  8.10it/s]

673it [01:52,  5.81it/s]

693it [01:55,  5.81it/s]
Steps690 | Train loss: 0.007 | Train acc: 0.871 | Test loss: 0.009 | Test acc: 0.834

709it [01:57,  8.11it/s]
  0%|                                                                                                                                                                                                                                                                           | 0/5 [01:58<?, ?it/s]
Traceback (most recent call last):
  File "test_trainer.py", line 29, in <module>
    unittest.main()
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/main.py", line 101, in __init__
    self.runTests()
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/main.py", line 271, in runTests
    self.result = testRunner.run(self.test)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/runner.py", line 176, in run
    test(result)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 84, in __call__
    return self.run(*args, **kwds)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 122, in run
    test(result)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 84, in __call__
    return self.run(*args, **kwds)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 122, in run
    test(result)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/case.py", line 676, in __call__
    return self.run(*args, **kwds)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/case.py", line 628, in run
    testMethod()
  File "test_trainer.py", line 25, in test_train_function
    trained_model = train(self.model, self.config, self.train_dataset, self.val_dataset)
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/src/vit_planetarium/training/trainer.py", line 74, in train
    for idx, (images, labels) in tqdm(enumerate(train_loader)):
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/tqdm/std.py", line 1182, in __iter__
    for obj in iterable:
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/dataloader.py", line 628, in __next__
    data = self._next_data()
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/dataloader.py", line 671, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py", line 58, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py", line 58, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torchvision/datasets/mnist.py", line 138, in __getitem__
    img, target = self.data[index], int(self.targets[index])
KeyboardInterrupt