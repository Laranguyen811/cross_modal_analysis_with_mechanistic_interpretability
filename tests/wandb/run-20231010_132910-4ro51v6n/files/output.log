
Config is: GlobalConfig(image=ImageConfig(image_size=32, patch_size=7, n_channels=1), transformer=TransformerConfig(hidden_dim=128, num_heads=4, num_layers=4, mlp_dim=512, activation_name='GELU', attention_only=False, attn_hidden_layer=True), layernorm=LayerNormConfig(qknorm=False, layer_norm_eps=0.0), dropout=DropoutConfig(patch=0.0, position=0.0, attention=0.0, proj=0.0, mlp=0.0), init=InitializationConfig(weight_type='he', cls_std=1e-06, pos_std=0.02), training=TrainingConfig(loss_fn_name='CrossEntropy', lr=0.0003, num_epochs=50000, batch_size=256, warmup_steps=10, weight_decay=0.0, device='cuda', seed=0, optimizer_name='AdamW'), logging=LoggingConfig(log_dir='logs', log_frequency=30, print_every=0, use_wandb=True), saving=SavingConfig(parent_dir='/network/scratch/s/sonia.joseph/vit_planetarium', save_dir='checkpoints', save_checkpoints=True, save_cp_frequency=10), classification=<vit_planetarium.configs.CircleConfig.ClassificationConfig object at 0x7fb38d7ccb90>)

  0%|                                                                                                                                                                                                                                                                       | 0/50000 [00:05<?, ?it/s]


  0%|                                                                                                                                                                                                                                                            | 4/50000 [00:08<20:05:05,  1.45s/it]



  0%|                                                                                                                                                                                                                                                           | 11/50000 [00:15<13:12:43,  1.05it/s]


  0%|                                                                                                                                                                                                                                                           | 15/50000 [00:19<12:43:28,  1.09it/s]


  0%|                                                                                                                                                                                                                                                           | 19/50000 [00:23<13:43:34,  1.01it/s]


  0%|                                                                                                                                                                                                                                                           | 23/50000 [00:27<13:55:12,  1.00s/it]


  0%|▏                                                                                                                                                                                                                                                          | 27/50000 [00:31<13:54:59,  1.00s/it]


  0%|▏                                                                                                                                                                                                                                                          | 31/50000 [00:35<15:28:12,  1.11s/it]


  0%|▏                                                                                                                                                                                                                                                          | 36/50000 [00:39<13:56:35,  1.00s/it]


  0%|▏                                                                                                                                                                                                                                                          | 40/50000 [00:43<13:56:55,  1.01s/it]


  0%|▏                                                                                                                                                                                                                                                          | 44/50000 [00:47<13:58:54,  1.01s/it]


  0%|▏                                                                                                                                                                                                                                                          | 48/50000 [00:51<15:24:38,  1.11s/it]


  0%|▎                                                                                                                                                                                                                                                          | 52/50000 [00:55<15:44:26,  1.13s/it]


  0%|▎                                                                                                                                                                                                                                                          | 56/50000 [00:59<15:59:41,  1.15s/it]


  0%|▎                                                                                                                                                                                                                                                          | 60/50000 [01:03<10:55:37,  1.27it/s]


  0%|▎                                                                                                                                                                                                                                                          | 65/50000 [01:07<15:45:29,  1.14s/it]


  0%|▎                                                                                                                                                                                                                                                          | 69/50000 [01:11<15:53:48,  1.15s/it]


  0%|▎                                                                                                                                                                                                                                                          | 73/50000 [01:15<15:50:26,  1.14s/it]


  0%|▍                                                                                                                                                                                                                                                          | 77/50000 [01:19<10:54:21,  1.27it/s]


  0%|▍                                                                                                                                                                                                                                                          | 81/50000 [01:23<11:24:36,  1.22it/s]


  0%|▍                                                                                                                                                                                                                                                          | 86/50000 [01:27<15:50:19,  1.14s/it]


  0%|▍                                                                                                                                                                                                                                                          | 90/50000 [01:31<10:51:16,  1.28it/s]


  0%|▍                                                                                                                                                                                                                                                          | 94/50000 [01:35<11:24:36,  1.21it/s]


  0%|▍                                                                                                                                                                                                                                                          | 98/50000 [01:39<11:31:40,  1.20it/s]


  0%|▌                                                                                                                                                                                                                                                         | 102/50000 [01:42<11:36:13,  1.19it/s]



  0%|▌                                                                                                                                                                                                                                                         | 109/50000 [01:49<13:48:02,  1.00it/s]


  0%|▌                                                                                                                                                                                                                                                         | 114/50000 [01:53<12:31:11,  1.11it/s]


  0%|▌                                                                                                                                                                                                                                                         | 118/50000 [01:57<12:31:40,  1.11it/s]


  0%|▌                                                                                                                                                                                                                                                         | 122/50000 [02:01<13:34:18,  1.02it/s]


  0%|▋                                                                                                                                                                                                                                                         | 126/50000 [02:05<13:48:22,  1.00it/s]


  0%|▋                                                                                                                                                                                                                                                         | 130/50000 [02:09<13:47:54,  1.00it/s]


  0%|▋                                                                                                                                                                                                                                                         | 135/50000 [02:13<12:31:20,  1.11it/s]


  0%|▋                                                                                                                                                                                                                                                         | 139/50000 [02:17<13:31:18,  1.02it/s]


  0%|▋                                                                                                                                                                                                                                                         | 143/50000 [02:21<13:49:25,  1.00it/s]


  0%|▋                                                                                                                                                                                                                                                         | 147/50000 [02:25<13:48:55,  1.00it/s]


  0%|▊                                                                                                                                                                                                                                                         | 151/50000 [02:29<15:19:19,  1.11s/it]

  0%|▊                                                                                                                                                                                                                                                         | 154/50000 [02:32<13:43:12,  1.01it/s]
Traceback (most recent call last):
  File "test_trainer_circle.py", line 28, in <module>
    unittest.main()
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/main.py", line 101, in __init__
    self.runTests()
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/main.py", line 271, in runTests
    self.result = testRunner.run(self.test)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/runner.py", line 176, in run
    test(result)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 84, in __call__
    return self.run(*args, **kwds)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 122, in run
    test(result)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 84, in __call__
    return self.run(*args, **kwds)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/suite.py", line 122, in run
    test(result)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/case.py", line 676, in __call__
    return self.run(*args, **kwds)
  File "/cvmfs/ai.mila.quebec/apps/x86_64/debian/anaconda/3/lib/python3.7/unittest/case.py", line 628, in run
    testMethod()
  File "test_trainer_circle.py", line 24, in test_train_function
    trained_model = train(self.model, self.config, self.train_dataset, self.val_dataset)
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/src/vit_planetarium/training/trainer.py", line 56, in train
    train_acc = calculate_accuracy(model, train_loader, config.training.device)
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/src/vit_planetarium/training/training_utils.py", line 14, in calculate_accuracy
    for items in islice(data_loader, N // batch_size):
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/dataloader.py", line 628, in __next__
    data = self._next_data()
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/dataloader.py", line 671, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py", line 58, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py", line 58, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/src/vit_planetarium/dataloaders/circle.py", line 167, in __getitem__
    img = draw_circle_with_points(data_point[0], data_point[1], self.circle_metadata, model_type = self.model_type)
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/src/vit_planetarium/dataloaders/circle.py", line 86, in draw_circle_with_points
    check_if_valid_angle(angle2, angle_range)
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/src/vit_planetarium/dataloaders/circle.py", line 25, in check_if_valid_angle
    if not np.isin(angle, angle_range):
  File "<__array_function__ internals>", line 6, in isin
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/numpy/lib/arraysetops.py", line 736, in isin
    invert=invert).reshape(element.shape)
  File "<__array_function__ internals>", line 6, in in1d
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/numpy/lib/arraysetops.py", line 613, in in1d
    ar1, rev_idx = np.unique(ar1, return_inverse=True)
  File "<__array_function__ internals>", line 6, in unique
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/numpy/lib/arraysetops.py", line 272, in unique
    ret = _unique1d(ar, return_index, return_inverse, return_counts)
  File "/home/mila/s/sonia.joseph/ViT-Planetarium/env/lib/python3.7/site-packages/numpy/lib/arraysetops.py", line 348, in _unique1d
    mask[1:] = aux[1:] != aux[:-1]
KeyboardInterrupt